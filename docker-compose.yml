services:
  admin-page:
    build:
      context: .
      dockerfile: Dockerfile
    image: admin-unlocktool:latest
    container_name: admin-unlocktool
    restart: unless-stopped
    mem_limit: 64m
    environment:
      - TZ=Asia/Jakarta
    networks:
      - kreanovasi_appnet
    labels:
      - "traefik.enable=true"
      - "traefik.docker.network=kreanovasi_appnet"
      # HTTPS Router
      - "traefik.http.routers.admin-secure.rule=Host(`admin.sewaunlocktool.id`)"
      - "traefik.http.routers.admin-secure.entrypoints=websecure"
      - "traefik.http.routers.admin-secure.tls.certresolver=le"
      - "traefik.http.routers.admin-secure.service=admin-svc"
      # HTTP Router (redirect to HTTPS)
      - "traefik.http.routers.admin.rule=Host(`admin.sewaunlocktool.id`)"
      - "traefik.http.routers.admin.entrypoints=web"
      - "traefik.http.routers.admin.middlewares=admin-https-redirect"
      # Middlewares
      - "traefik.http.middlewares.admin-https-redirect.redirectscheme.scheme=https"
      - "traefik.http.middlewares.admin-https-redirect.redirectscheme.permanent=true"
      # Service
      - "traefik.http.services.admin-svc.loadbalancer.server.port=80"

networks:
  kreanovasi_appnet:
    external: true
